<!DOCTYPE html>
<html lang="id">
<head>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

  <meta charset="UTF-8">
  <title>How to Play</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    @font-face {
      font-family: 'MonsterParty';
      src: url('assets/fonts/monsterparty.ttf') format('truetype');
    }

    body {
      margin: 0;
      padding: 0;
      background-image: url('background.jpg');
      background-size: cover;
      background-position: center;
      font-family: 'MonsterParty', sans-serif;
      color: #fff;
      overflow-x: hidden;
      min-height: 200vh; /* More space for scrolling */
    }

    .gesture-info {
      font-family: 'sans-serif';
      background-color: #000000;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      color: #333;
      line-height: 1.6;
      font-size: 40px;
      max-width: 600px;
      margin: 20px auto;
      text-align: center;
    }

    .container {
      width: 70%;
      margin: 50px auto;
      background: rgba(0, 0, 0, 0.85);
      border: 4px solid crimson;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 0 25px crimson;
      text-align: center;
    }

    h1 {
      font-size: 80px;
      color: crimson;
      text-shadow: 3px 3px 7px black;
      margin-bottom: 30px;
    }

    .instructions {
      font-size: 45px;
      line-height: 1.8;
      color: #ffdddd;
      text-shadow: 1px 1px 3px black;
      margin-bottom: 30px;
    }

    .instructions img {
      width: 80px;
      vertical-align: middle;
      margin: 0 10px;
    }

    .btn {
      display: inline-block;
      margin-top: 45px;
      padding: 14px 32px;
      background-color: crimson;
      color: white;
      text-decoration: none;
      font-size: 28px;
      font-family: 'MonsterParty', sans-serif;
      border-radius: 12px;
      box-shadow: 0 0 15px crimson, 0 0 25px red;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background-color: darkred;
      box-shadow: 0 0 20px red, 0 0 30px crimson;
      transform: scale(1.05);
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .container {
        width: 90%;
        padding: 20px;
      }

      h1 {
        font-size: 48px;
      }

      .instructions {
        font-size: 22px;
      }

      .btn {
        font-size: 24px;
        padding: 12px 24px;
      }

      .instructions img {
        width: 60px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 36px;
      }

      .instructions {
        font-size: 20px;
      }

      .btn {
        font-size: 20px;
        padding: 10px 20px;
      }

      .instructions img {
        width: 50px;
      }
    }

    .gesture-status {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 16px;
      z-index: 1000;
    }
    
    .gesture-pointer {
      position: fixed;
      width: 30px;
      height: 30px;
      background-color: rgba(220, 20, 60, 0.7);
      border-radius: 50%;
      z-index: 999;
      pointer-events: none;
      transform: translate(-50%, -50%);
      display: none;
    }
  </style>
</head>
<body>
  <video class="input_video" style="display:none;"></video>
  <canvas class="output_canvas" width="640" height="480" style="display:none;"></canvas>

  <div class="container">
    <h1>How to Play</h1>
    <div class="instructions">

      <p style="color: crimson; font-size: 30px;">Gesture Control: <br>
      - Arahkan jari telunjuk ke atas/bawah untuk scroll<br>
      - Kepalkan tangan untuk kembali ke menu</p>
      
      <p>
        Gunakan 
        <img src="assets/sprites/wasd2.png" alt="WASD"> 
        untuk bergerak: <br>
        W untuk bergerak ke atas, A untuk bergerak ke kiri, S untuk bergerak ke bawah, D untuk bergerak ke kanan.
      </p>
      <p>Gunakan mouse untuk mengarahkan peluru ke Zombie musuh.</p>
      <p>Tekan <strong>SHIFT</strong> untuk Sprint.</p>
      <p>Tekan <strong>F</strong> untuk menjatuhkan senjata saat ini.</p>
      <p>Tekan <strong>R</strong> untuk Reload.</p>
      <p>Ucapkan <strong>"Dor"</strong> untuk menembak peluru!</p>
      <p style="color: crimson; font-size: 30px;">Gesture Control: <br>
      - Arahkan jari telunjuk ke atas/bawah untuk scroll<br>
      - Kepalkan tangan untuk kembali ke menu</p>
    </div>
    
    <a href="index.html" class="btn">Back to Menu</a>
  </div>

  <div class="gesture-status" id="gestureStatus">
    Gesture status: Waiting for hand detection...
  </div>
  
  <div class="gesture-pointer" id="gesturePointer"></div>

  <script>
  const videoElement = document.querySelector('.input_video');
  const gestureStatus = document.getElementById('gestureStatus');
  const gesturePointer = document.getElementById('gesturePointer');
  
  const hands = new Hands({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
  });

  hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  // Scrolling variables
  let scrollSpeed = 0;
  let scrollInterval = null;
  let lastIndexY = 0;
  let fistTimer = null;
  let handDetected = false;

  // Function to handle continuous scrolling
  function handleScroll() {
    if (Math.abs(scrollSpeed) > 0) {
      window.scrollBy(0, scrollSpeed);
    }
  }

  // Check if hand is making a fist
  function isFist(landmarks) {
    const fingerTips = [8, 12, 16, 20]; // Index, Middle, Ring, Pinky tips
    const fingerJoints = [6, 10, 14, 18]; // Proximal joints
    
    // Check if all fingertips are close to their respective joints
    for (let i = 0; i < 4; i++) {
      const tip = landmarks[fingerTips[i]];
      const joint = landmarks[fingerJoints[i]];
      const distance = Math.sqrt(
        Math.pow(tip.x - joint.x, 2) + 
        Math.pow(tip.y - joint.y, 2)
      );
      
      if (distance > 0.1) { // Threshold for fist detection
        return false;
      }
    }
    return true;
  }

  hands.onResults((results) => {
    if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
      if (handDetected) {
        handDetected = false;
        gestureStatus.textContent = "Gesture status: Hand lost";
        gesturePointer.style.display = 'none';
        
        // Stop scrolling when hand is lost
        scrollSpeed = 0;
        if (scrollInterval) {
          clearInterval(scrollInterval);
          scrollInterval = null;
        }
      }
      return;
    }
    
    handDetected = true;
    const landmarks = results.multiHandLandmarks[0];
    const indexFinger = landmarks[8];  // Index finger tip
    const wrist = landmarks[0];        // Wrist
    
    // Update pointer position
    gesturePointer.style.display = 'block';
    gesturePointer.style.left = `${indexFinger.x * window.innerWidth}px`;
    gesturePointer.style.top = `${indexFinger.y * window.innerHeight}px`;
    
    // FIST DETECTION (for menu navigation)
    if (isFist(landmarks)) {
      if (!fistTimer) {
        fistTimer = setTimeout(() => {
          gestureStatus.textContent = "Gesture status: Returning to menu...";
          window.location.href = 'index.html';
        }, 1000); // 1 second hold
        gestureStatus.textContent = "Gesture status: Fist detected - udah nih ya dah siap main ?";
      }
    } else {
      if (fistTimer) {
        clearTimeout(fistTimer);
        fistTimer = null;
      }
      
      // SCROLL GESTURE (vertical movement)
      const currentY = indexFinger.y;
      const wristY = wrist.y;
      
      // Calculate direction based on finger position relative to wrist
      if (currentY < wristY - 0.1) { // Finger above wrist
        scrollSpeed = -5; // Scroll up
        gestureStatus.textContent = "Gesture status: Scrolling UP";
      } 
      else if (currentY > wristY + 0.1) { // Finger below wrist
        scrollSpeed = 5; // Scroll down
        gestureStatus.textContent = "Gesture status: Scrolling DOWN";
      }
      else {
        scrollSpeed = 0; // Stop scrolling
        gestureStatus.textContent = "Gesture status: Hand detected - point up/down to scroll";
      }
      
      // Start scroll interval if not already running
      if (scrollSpeed !== 0 && !scrollInterval) {
        scrollInterval = setInterval(handleScroll, 16); // ~60fps
      } 
      else if (scrollSpeed === 0 && scrollInterval) {
        clearInterval(scrollInterval);
        scrollInterval = null;
      }
    }
  });

  const camera = new Camera(videoElement, {
    onFrame: async () => {
      try {
        await hands.send({ image: videoElement });
      } catch (e) {
        console.error("Error in hand detection:", e);
        gestureStatus.textContent = "Error: " + e.message;
      }
    },
    width: 640,
    height: 480
  });
  
  camera.start().catch(e => {
    console.error("Camera error:", e);
    gestureStatus.textContent = "Camera error: " + e.message;
  });
  </script>
</body>
</html>